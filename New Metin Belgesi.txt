1) Hedef ve kapsam (Codexâ€™in asla ÅŸaÅŸmamasÄ± gereken Ã§erÃ§eve)

Proje adÄ±: colsim (Collimator Simulator)
Ana hedef:

Backscatter pencil-beam kolimatÃ¶r (slit/disk) ve LINAC fan-beam kolimatÃ¶r (jaw) iÃ§in:

hÄ±zlÄ± analitik metrikler: beam width, penumbra, FWHM

hÄ±zlÄ± gÃ¼venlik katmanÄ±: leakage â†’ dÄ±ÅŸ doz â†’ boundary (2.5 ÂµSv/h) (point-kernel + attenuation + buildup)

batch koÅŸum ve sonuÃ§larÄ±n GUIâ€™de gÃ¶sterimi

Kapsam dÄ±ÅŸÄ± (MVP):

Tam skyshine ve tam MC (Geant4) doÄŸrulama: Phase-2

Malzeme ayrÄ±mÄ±/kontrabant sÄ±nÄ±flandÄ±rma gibi AI iÅŸler: yok

2) Codex Ã§alÄ±ÅŸma modu: â€œGUI odaklÄ±, arka planda batchâ€

Codexâ€™in geliÅŸtireceÄŸi mimari ÅŸudur:

GUI â†’ project.yaml Ã¼retir

colsim run ... komutu â†’ headless motoru Ã§alÄ±ÅŸtÄ±rÄ±r

results/ altÄ±na standardize Ã§Ä±ktÄ±lar yazar

GUI sadece Ã§Ä±ktÄ±yÄ± okur ve plot/tablolaÅŸtÄ±rÄ±r

Bu model Codexâ€™in uzun gÃ¶revlerde repo iÃ§inde dosya/komut/test akÄ±ÅŸÄ±yla ilerlemesine uygun.

3) Repo kurallarÄ± (Codexâ€™e net â€œkontratâ€)
3.1. KlasÃ¶r yapÄ±sÄ± (zorunlu)
colsim/
  app/                 # GUI (PyQt6)
  core/                # motorlar: geometry + safety
  data/
    xcom_cache/        # NIST XCOM'dan tÃ¼retilen Âµ/Ï cache (offline dosya)
    buildup_gp/        # GP param tablolarÄ± (materyal/enerji grid)
  cli/                 # colsim run / validate komutlarÄ±
  schemas/             # project.yaml ÅŸemasÄ± (JSONSchema/YAML schema)
  tests/               # unit + golden tests
  docs/                # kullanÄ±cÄ± (mÃ¼hendis) dokÃ¼manÄ±
3.2. Ã‡Ä±ktÄ± kontratÄ± (zorunlu)

Her koÅŸumda:

results/metrics.csv (tek satÄ±r summary + meta)

results/profile_1d.csv (x, value)

results/boundary_map.csv (angle/radius grid ya da nokta listesi)

logs/run.log

3.3. â€œDoneâ€ kriterleri

Codex bir iÅŸi bitirdi sayÄ±lmaz, ÅŸu 3â€™Ã¼ saÄŸlamadan PR Ã§Ä±karamaz:

pytest yeÅŸil

docs/ altÄ±nda ilgili sayfa gÃ¼ncel

â€œgolden testâ€ (senin Ã¶rnek kolimatÃ¶r senaryon) aynÄ± sonucu veriyor (tolerans tanÄ±mlÄ±)

4) Hesap motoru yÃ¶nergesi (hÄ±zlÄ± ama kullanÄ±labilir)
4.1. Geometry (pencil-beam)

Girdiler: slit, source_diameter, mesafeler, disk iÃ§/dÄ±ÅŸ Ã§ap, kalÄ±nlÄ±k

Ã‡Ä±ktÄ±lar:

footprint

penumbra (10â€“90 veya 20â€“80 seÃ§ilebilir)

FWHM (kabul edilen profil varsayÄ±mÄ±yla)

Burada buildup kullanma. Sadece geometri.

4.2. Safety (leakage + boundary)

Girdiler:

duty_cycle: beam_on_s, scans_per_hour

boundary: ring radius(lar) veya nokta seti

material: W/Pb/steel vs

Âµ(E): XCOM cache

buildup: GP param (enerji+kalÄ±nlÄ±k/mfp)

Model:

point-kernel: 
1
/
ğ‘Ÿ
2
1/r
2
 + 
ğ‘’
âˆ’
ğœ‡
ğ‘¥
e
âˆ’Î¼x
 + 
ğµ
(
ğ¸
,
ğ‘¥
)
B(E,x)

enerji binleme (log bins)

Ã‡Ä±ktÄ±lar:

instant dose rate map

hourly average dose rate map

max boundary value + PASS/FAIL (2.5 ÂµSv/h)

6 MeV iÃ§in â€œkonservatif modâ€ zorunlu: leakage fraction veya gÃ¼venlik Ã§arpanÄ± configâ€™ten yÃ¶netilecek.

5) Codex gÃ¶rev yÃ¼rÃ¼tme standardÄ± (her gÃ¶revde uygulanacak)
5.1. Plan â†’ Uygula â†’ KanÄ±tla dÃ¶ngÃ¼sÃ¼

Codex her taskâ€™te:

PLAN.md iÃ§ine 10â€“20 satÄ±rlÄ±k plan yazar (deÄŸiÅŸecek dosyalar + test planÄ±)

Uygular

KanÄ±tlar: test Ã§Ä±ktÄ±sÄ± + Ã¶rnek run log snippet

5.2. KÃ¼Ã§Ã¼k PR kuralÄ±

Tek PR = tek konu (Ã¶r: sadece boundary map)

BÃ¼yÃ¼k refactor ancak â€œhazÄ±r testâ€ varken

5.3. Hata politkasÄ±

Sessizce varsayÄ±m yapma.

VarsayÄ±m gerekiyorsa project.yaml iÃ§inde aÃ§Ä±k parametre yap.

6) Skill olarak paketleme (Codexâ€™e â€œkurumsal talimatâ€)

Codex skills yapÄ±sÄ± iÃ§in repoya ÅŸu klasÃ¶rÃ¼ koy:

skills/colsim-engineering/SKILL.md
skills/colsim-engineering/resources/...
skills/colsim-engineering/scripts/...

Skill kavramÄ± ve SKILL.md manifest yaklaÅŸÄ±mÄ± Codex dokÃ¼mantasyonunda tarif ediliyor.

6.1. Ã–rnek SKILL.md (kopyala-yapÄ±ÅŸtÄ±r)
---
name: colsim-engineering
description: ColSim (collimator simulator) iÃ§in mÃ¼hendis odaklÄ± geliÅŸtirme yÃ¶nergesi: GUI+batch, geometry + safety (leakage/boundary) motoru, test ve Ã§Ä±ktÄ± kontratÄ±.
version: 0.1.0
---

# Primary goal
- Pencil-beam ve fan-beam kolimatÃ¶r analizi: geometry metrikleri + safety (leakage â†’ boundary dose).

# Non-goals (MVP)
- Full Geant4 doÄŸrulama, skyshine, kompleks materyal sÄ±nÄ±flandÄ±rma.

# Repo rules
- Ã‡Ä±ktÄ± kontratÄ±: results/metrics.csv, profile_1d.csv, boundary_map.csv, logs/run.log
- Her deÄŸiÅŸiklik: pytest + docs gÃ¼ncelle + golden test.

# Engineering workflow
1) PLAN.md gÃ¼ncelle
2) kÃ¼Ã§Ã¼k PR
3) test kanÄ±tÄ± ekle

# Safety model notes
- Safety modunda point-kernel + attenuation + GP buildup.
- 6 MeV: conservative factor zorunlu (configâ€™ten).

# Deliverables
- CLI: `colsim run project.yaml`
- GUI: PyQt6, sadece proje oluÅŸturur ve sonuÃ§ gÃ¶sterir.
7) Codexâ€™e verilecek â€œbaÅŸlangÄ±Ã§ promptâ€ (ilk gÃ¶rev)

Codexâ€™e ÅŸunu gÃ¶rev olarak ver:

â€œproject.yaml ÅŸemasÄ±nÄ± (schemas/) oluÅŸturâ€

â€œcolsim run CLI iskeletini yazâ€

â€œGeometry motoru (pencil-beam) iÃ§in metrikleri Ã¼ret ve results/metrics.csv formatÄ±na dÃ¶kâ€

â€œGolden test: (senin disk kolimatÃ¶r senaryonu) tests/test_golden_pencilbeam.py olarak ekleâ€
